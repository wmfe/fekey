(function(){function a(e,c,h){if(e.length===+e.length){for(var g=0,d=e.length;g<d;g++){if(c.call(h,g,e[g],e)===false){return}}}else{for(var f in e){if(e.hasOwnProperty(f)){if(c.call(h,f,e[f],e)===false){return}}}}}var b=function(d,c){this._render_start=d.render_start;this._data=d;this._render_timing={ht:0,vt:0,drt:0,tti:0,lt:0,fvt:0,crt:0};this._conf=c||{log_path:"http://static.tieba.baidu.com/tb/pms/img/st.gif",img_conn_path:"http://xs.tieba.baidu.com/cache_monitor",display:false};if(window.PDC&&PDC._opt.log_path){this._conf.log_path=PDC._opt.log_path}this._performance_timing={};this._metrics=[];a(d.timing,function(f,g){this._render_timing[f]=g},this);var e=this;if(document.attachEvent){window.attachEvent("onbeforeunload",function(){e._unload_send()})}else{window.addEventListener("beforeunload",function(){e._unload_send()},false)}this._measureScreen();this._browser();this._measureNetworkTime();this._measureRenderTime();this._speicalParams();this._ready()};b.prototype._speicalParams=function(){var c=window.PDC&&PDC._opt&&PDC._opt.s_params;if(c){a(c,function(e,d){this._metrics.push("cus_"+e+"="+d)},this)}};b.prototype._ready=function(){this.send()};b.prototype._measureScreen=function(){if(window.screen){this._metrics.push("_screen="+window.screen.width+"*"+window.screen.height+"|"+window.screen.availWidth+"*"+window.screen.availHeight)}};b.prototype.getFPT=function(){var c;if(window.performance&&performance.timing&&performance.timing.msFirstPaint){c=performance.timing.msFirstPaint}else{if(window.chrome&&chrome.loadTimes){c=parseInt(chrome.loadTimes().firstPaintTime*1000)}}return c};b.prototype._measureNetworkTime=function(){var c={};var d=0;if(window.performance&&performance.timing){var f=performance.timing;d=f.domainLookupStart;c.dns=f.domainLookupEnd;c.ct=f.connectEnd;c.st=f.responseStart;c.tt=f.responseEnd;c.dct=f.domComplete;c.olt=f.loadEventEnd;if(this.getFPT()){c.nfpt=this.getFPT();c.p_nfpt=c.nfpt;c.c_nfpt=c.nfpt}var e=PDC._render_start-d;e>0&&this._metrics.push("wtt="+e)}this._measureTime(d,c)};b.prototype._measureTime=function(d,e){var c=0;a(e,function(f,g){c=(""+g).length<8?g:g-d;this._metrics.push(f+"="+c)},this)};b.prototype._measureRenderTime=function(){if(window.performance&&window.performance.timing){var c=window.performance.timing;this._performance_timing=c;this._render_timing.lt=c.loadEventStart;if(c.loadEventEnd>0){this._render_timing.let=c.loadEventEnd}}if(this.getFPT()){this._render_timing.fpt=this.getFPT()}if(this._render_timing.fvt==0){this._render_timing.fvt=this._render_timing.crt=this._render_timing.let}this._measureTime(this._render_start,this._render_timing)};b.prototype._browser=function(){var e=this._uaMatch(navigator.userAgent);var c=e.browser;if(c=="msie"){if(document.documentMode){var f=e.version.substring(0,1);if(window.performance){c+="9.0";this._metrics.push("ebrowser="+f+"9"+document.documentMode)}else{c+="8.0";this._metrics.push("ebrowser="+f+"8"+document.documentMode)}}else{c+=e.version}}var d={"msie6.0":16,"msie7.0":17,"msie8.0":18,"msie9.0":19,chrome:20,mozilla:30,safari:40,opera:50};this._metrics.push("browser="+(d[c]||0))};b.prototype._uaMatch=function(d){var j=/(chrome)\/(\d+\.\d)/,f=/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/,c=/(opera)(?:.*version)?[ \/]([\w.]+)/,e=/(msie) ([\w.]+)/,g=/(mozilla)(?:.*? rv:([\w.]+))?/,d=d.toLowerCase(),h={};var i=j.exec(d)||c.exec(d)||e.exec(d)||d.indexOf("compatible")<0&&g.exec(d)||[];if(f.test(d)&&!/chrome/.test(d)){i[1]="safari";i[2]=RegExp["$1"]||RegExp["$2"]}return{browser:i[1]||"unknown",version:i[2]||"0"}};b.prototype.send=function(){if(b._is_send){return}b._is_send=true;var f=this._data.env,c=this._metrics,d=this._connection_num;a(f,function(g,h){c.push(g+"="+h)});if(window._trace_page_logid){c.push("logid="+_trace_page_logid)}c.push("pf="+navigator.platform);c.push("_t="+new Date()*1);var e=document.createElement("img");e.src=this._conf.log_path+"?"+c.join("&");window["___pms_img_"+new Date()*1]=e};b.prototype._unload_send=function(){if(b._is_unload_send){return}b._is_unload_send=true;var g=this._data.env,c=[];if(window.F&&F.fisMark){var d=this._render_start,f=[];a(F.fisMark,function(i,j){var h=[];a(j,function(l,k){h.push('"'+l+'":'+(k-d))},this);f.push('"'+i+'":{'+h.join(",")+"}")},this);c.push("fis_timing={"+f.join(",")+"}")}if(c.length>0){a(g,function(h,i){c.push(h+"="+i)});var e=document.createElement("img");e.src=this._conf.log_path+"?"+c.join("&");window["___pms_img_"+new Date()*1]=e}};if(!window.WPO_PDA){window.WPO_PDA=new b(PDC.metadata())}})();
if (window["PDC"] && PDC.oldNetTest) {! function() {window.__wpo = {}, __wpo.util = {extend: function(a, b) {for (var c in b) a[c] = b[c]; return a }, now: function() {return (new Date).getTime() } }, __wpo.util.param = function(a) {var d, b = [], c = ""; for (d in a) c = "undefined" == typeof a[d] ? "" : a[d], b.push(d + "=" + c); return b.join("&") }, __wpo.log = {_opt: {log_path: "http://static.tieba.baidu.com/tb/pms/img/st.gif"}, _data: {}, setOpt: function(a) {__wpo.util.extend(this._opt, a) }, push: function(a) {__wpo.util.extend(this._data, a) }, send: function() {var a = document.createElement("img"), b = (new Date).getTime(); this._data._t = b, a.src = this._opt.log_path + "?" + __wpo.util.param(this._data), window["___pms_img_" + b] = a, this._data = {} } }, __wpo.network = {_opt: {}, test: function(a, b) {var c = new __wpo.NetworkTester(a, b); c.run() } }, __wpo.NetworkTester = function(a, b) {this._END_NUM = 5, this._START_NUM = 2, this._IMG_OPT = {img_1: ["img/1.jpg", 0], img_2: ["img/2.gif", 0], img_3: ["img/3.gif", 0], img_4: ["img/4.jpg", 10583 / 1024], img_5: ["img/5.jpg", 59906 / 1024] }, this._timecost = {}, this._ext_data = b || {}, this._img_path = a }, __wpo.NetworkTester.prototype.run = function() {this._loadTestImg(this._START_NUM) }, __wpo.NetworkTester.prototype._report = function() {var h, a = this._timecost.t3, b = this._IMG_OPT.img_4[1], c = this._IMG_OPT.img_5[1], d = this._timecost.t4, e = this._timecost.t5, f = 0, g = 0; d > a && (f = b / ((d - a) / 1e3)), g = (c - b) / ((e - d) / 1e3), h = {rtt: a, bw1: f.toFixed(1), bw2: g.toFixed(1) }, h.c_rtt = h.rtt, h.c_bw1 = h.bw1, h.c_bw2 = h.bw2, __wpo.log.push(this._ext_data), __wpo.log.push(h), __wpo.log.send() }, __wpo.NetworkTester.prototype._loadTestImg = function(a) {var b = document.createElement("img"), c = this, d = (new Date).getTime(), e = "" + this._img_path + this._IMG_OPT["img_" + a][0] + "?t=" + d + "&index=" + a; b.onload = function() {var e, b = (new Date).getTime(); c._timecost["t" + a] = b - d, e = a + 1, e <= c._END_NUM ? c._loadTestImg(e) : c._report() }, b.src = e, window["___pms_img_net_" + d] = b } }(), function() {var g, h, a = {product_id: 10, page_id: PDC.idforWebSpeed, sample: PDC.oldNetTest.sample, domains: PDC.oldNetTest.domains }, b = Math.random(), c = a.domains.length, d = a.sample, e = {product_id: a.product_id, page_id: a.page_id, domain: ""}, f = ""; d > b && (g = Math.floor(b / (d / c)), c > g && (h = a.domains[g], f = h.img_path, e.domain = h.domain), "" != f && setTimeout(function() {__wpo.network.test(f, e) }, 1e3)) }(); }