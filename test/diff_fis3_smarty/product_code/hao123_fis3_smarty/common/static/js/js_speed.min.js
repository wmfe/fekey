(function(window) {
    /**
     * 上报Timing数据
     * 函数必须在页面加载完成之后才能执行，一般可以放在window.onload里调用，
     * 或者在其他页面加载完成之后才执行的函数里调用
     */

    var sendReport = function(){
        var uaqTaskID = window.conf.uaq.uaqTaskID; 
        var _p = (window.webkitPerformance ? window.webkitPerformance : window.msPerformance);
        _p = (_p ? _p : window.performance);

        var _t, _sa = [], _ti = ["navigationStart","unloadEventStart","unloadEventEnd",
            "redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd",
            "connectStart","connectEnd","secureConnectionStart","requestStart","responseStart",
            "responseEnd","domLoading","domInteractive","domContentLoadedEventStart",
            "domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];

        if (_p && (_t = _p.timing)) {
            for (var i in _ti){
                var _tmp = _t[_ti[i]];
                _tmp = (_tmp ? _tmp : 0);
                _sa.push(_ti[i] + "=" + _tmp);
            }

            var uaqReportUrl = "http://uaqport.baidu.com/jsspeed.php";
            uaqReportUrl += "?id=" + uaqTaskID + "&" + _sa.join("&");

            var _img = new Image();
            setTimeout(function(){
                _img.src = uaqReportUrl;
            },1000);
        }
    };
    window.sendTimeToUAQ = function(){
        var sendProbability = window.conf.uaq.sendProbability;
        if (Math.random() <= sendProbability) {
            sendReport();
        }
    };
})(window);

/**
 *以下代码用户将数据上报函数注册在window的onload事件中
 *您也可以使用其他方式执行window.sendTimeToUAQ函数，
 *但是要保证该函数一定在页面的onload的事件发生之后执行，
 *否则会造成回传数据不准确
*/
if (window.addEventListener) {  
    window.addEventListener("load", window.sendTimeToUAQ, false);  
} else {
    window.attachEvent("onload",window.sendTimeToUAQ);
}
